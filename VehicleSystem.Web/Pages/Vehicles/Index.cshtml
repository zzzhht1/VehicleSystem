@page
@model VehicleSystem.Web.Pages.Vehicles.IndexModel

<div class="container mt-4">
    <h2>车辆管理系统</h2>
    
    <div class="mb-3">
        <form method="get" class="form-inline">
            <div class="input-group mb-3">
                <input asp-for="SearchTerm" class="form-control" placeholder="输入车牌号...">
                <div class="input-group-append">
                    <button type="submit" class="btn btn-primary">搜索</button>
                </div>
            </div>
            <span asp-validation-for="SearchTerm" class="text-danger"></span>
        </form>
    </div>

    <div id="vehicleTable">
        <!-- AJAX内容将在此加载 -->
    </div>

    <div class="mt-3">
    <nav aria-label="Page navigation">
        <ul class="pagination" id="pagination">
        </ul>
    </div>
</div>

@section Scripts{
<script>
let currentPage = 1;
const pageSize = 10;

$(document).ready(function(){
    loadData();
    
    $('#searchInput').on('input', _.debounce(function(){
        currentPage = 1;
        loadData();
    }, 300));
});

function loadData() {
    $.ajax({
        url: '?handler=Async',
        data: {
            pageNumber: currentPage,
            pageSize: pageSize,
            search: $('#searchInput').val()
        },
        success: function(response){
            renderTable(response.items);
            renderPagination(response.totalCount);
        }
    });
}

function renderTable(vehicles){
    let html = `<table class="table table-striped table-hover">
    <caption>共 @Model.TotalCount 条记录</caption>
        <thead>
            <tr>
                <th>车牌号</th>
                <th>VIN码</th>
                <th>品牌</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>`;

    vehicles.forEach(v => {
        html += `<tr>
            <td>${v.licensePlate}</td>
            <td>${v.vin}</td>
            <td>${v.brand}</td>
            <td>
                <button class="btn btn-sm btn-primary">编辑</button>
                <button class="btn btn-sm btn-danger">删除</button>
            </td>
        </tr>`;
    });

    html += '</tbody></table>';
    $('#vehicleTable').html(html);
}

function renderPagination(totalCount){
    const totalPages = Math.ceil(totalCount / pageSize);
    let html = '';
    
    for(let i=1; i<=totalPages; i++){
        html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
            <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
        </li>`;
    }
    
    $('#pagination').html(html);
}

function changePage(page){
    currentPage = page;
    loadData();
}
</script>
}