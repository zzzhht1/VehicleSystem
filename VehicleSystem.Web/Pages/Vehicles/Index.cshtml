@page
@model VehicleSystem.Web.Pages.Vehicles.IndexModel

<div class="container mt-4">
    <h2>车辆信息</h2>
    
    <div class="mb-3">
        <form method="get" class="form-inline">
            <div class="input-group mb-3">
                <input asp-for="SearchTerm" class="form-control" 
                    placeholder="输入车牌号..." id="searchInput">
                <div class="input-group-append">
                    <button type="submit" class="btn btn-primary">搜索</button>
                </div>
            </div>
        </form>
    </div>

    <div id="vehicleTable">
        <!-- 异步加载内容 -->
    </div>

    <div class="mt-3">
        <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination"></ul>
        </nav>
    </div>
</div>

@section Scripts {
<script>
    let currentPage = 1;
    const pageSize = 10;

    $(document).ready(function(){
        loadData();
        
        $('#searchInput').on('input', _.debounce(function(){
            currentPage = 1;
            loadData();
        }, 300));
    });

    function loadData() {
        $.ajax({
            url: '?handler=AsyncData',
            data: {
                pageNumber: currentPage,
                pageSize: pageSize,
                searchTerm: $('#searchInput').val()
            },
            success: function(response){
                renderTable(response.items, response.totalCount);
                renderPagination(response.totalCount);
            }
        });
    }

    function renderTable(vehicles, totalCount) {
        let html = `<table class="table table-striped table-hover">
            <caption>共 ${totalCount} 条记录</caption>
            <thead>
                <tr>
                    <th>牌照</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>`;

        vehicles.forEach(v => {
            html += `<tr>
                <td>${v.plateNumber}</td>
                        <td>${v.status}</td> <!-- 注意 Status 首字母大写 -->
                <td>
                    <button class="btn btn-sm btn-primary">编辑</button>
                    <button class="btn btn-sm btn-danger">删除</button>
                </td>
            </tr>`;
        });

        html += '</tbody></table>';
        $('#vehicleTable').html(html);
    }

    function renderPagination(totalCount) {
        const totalPages = Math.ceil(totalCount / pageSize);
        let html = '';
        
        for(let i = 1; i <= totalPages; i++) {
            html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
                <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
            </li>`;
        }
        
        $('#pagination').html(html);
    }

    function changePage(page) {
        currentPage = page;
        loadData();
    }
</script>
}
